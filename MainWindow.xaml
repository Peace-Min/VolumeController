<Window x:Class="VolumeController.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:VolumeController"
        mc:Ignorable="d"
        Title="Volume Controller" Height="200" Width="400">
    <Window.Resources>
        <local:VolumeToIconConverter x:Key="VolumeToIconConverter"/>
    </Window.Resources>
    <Grid Margin="20">
        <StackPanel VerticalAlignment="Center">
            <TextBlock Text="System Volume" HorizontalAlignment="Center" Margin="0,0,0,10" FontSize="16" FontWeight="Bold"/>
            
            <Grid Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Slider x:Name="VolumeSlider" Minimum="0" Maximum="100" Value="{Binding Volume}" VerticalAlignment="Center" PreviewMouseLeftButtonUp="VolumeSlider_PreviewMouseLeftButtonUp" PreviewKeyUp="VolumeSlider_PreviewKeyUp"/>
                <TextBlock x:Name="VolumeText" Text="{Binding VolumeText}" Grid.Column="1" Margin="10,0,0,0" VerticalAlignment="Center" Width="40" TextAlignment="Right"/>
            </Grid>

<CheckBox x:Name="MuteCheckBox" HorizontalAlignment="Center" IsChecked="{Binding IsMuted}" BorderThickness="0" Background="Transparent" Foreground="#333333" Tag="{Binding Volume}">
                <CheckBox.Template>
                    <ControlTemplate TargetType="CheckBox">
                        <Grid Background="Transparent" Width="48" Height="48">
                            <!-- Mute Icon Group (Visible only when IsChecked=True) -->
                            <Viewbox x:Name="MuteIconGroup" Width="36" Height="36" VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Collapsed">
                                <Canvas Width="24" Height="24">
                                    <!-- Body: Same as Volume -->
                                    <Path Fill="{Binding Foreground, RelativeSource={RelativeSource TemplatedParent}}" 
                                          Data="M4,9 L9,9 L14,4 L14,20 L9,15 L4,15 Z"/>
                                    
                                    <!-- X Mark: Stylized like the waves -->
                                    <Path Stroke="{Binding Foreground, RelativeSource={RelativeSource TemplatedParent}}" 
                                          StrokeThickness="2" 
                                          StrokeStartLineCap="Round" 
                                          StrokeEndLineCap="Round" 
                                          Data="M17.5,9.5 L21.5,14.5 M21.5,9.5 L17.5,14.5"/>
                                </Canvas>
                            </Viewbox>

                            <!-- Corrected Viewbox for 3-Level Windows Style (Thin Lines) -->
                            <Viewbox x:Name="VolumeIconGroup_Corrected" Width="36" Height="36" VerticalAlignment="Center" HorizontalAlignment="Center">
                                <Canvas Width="24" Height="24">
                                    <!-- Body: Filled -->
                                    <Path x:Name="SpkBody" 
                                          Fill="{Binding Foreground, RelativeSource={RelativeSource TemplatedParent}}" 
                                          Data="M4,9 L9,9 L14,4 L14,20 L9,15 L4,15 Z"/>
                                    
                                    <!-- Background Waves (Always Grey) -->
                                    <Path Stroke="{StaticResource VolumeWaveBackgroundBrush}" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round" Data="M16.5,9.5 A 3.5,3.5 0 0 1 16.5,14.5"/>
                                    <Path Stroke="{StaticResource VolumeWaveBackgroundBrush}" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round" Data="M19.5,7 A 7,7 0 0 1 19.5,17"/>
                                    <Path Stroke="{StaticResource VolumeWaveBackgroundBrush}" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round" Data="M22.5,4.5 A 10.5,10.5 0 0 1 22.5,19.5"/>

                                    <!-- Active Waves: Overlay that turns color -->
                                    <!-- Small Wave -->
                                    <Path x:Name="WaveS" 
                                          Stroke="Transparent" 
                                          StrokeThickness="2"
                                          StrokeStartLineCap="Round"
                                          StrokeEndLineCap="Round"
                                          Data="M16.5,9.5 A 3.5,3.5 0 0 1 16.5,14.5"/>
                                    
                                    <!-- Medium Wave -->
                                    <Path x:Name="WaveM" 
                                          Stroke="Transparent" 
                                          StrokeThickness="2"
                                          StrokeStartLineCap="Round"
                                          StrokeEndLineCap="Round"
                                          Data="M19.5,7 A 7,7 0 0 1 19.5,17"/>
                                    
                                    <!-- Large Wave -->
                                    <Path x:Name="WaveL" 
                                          Stroke="Transparent" 
                                          StrokeThickness="2" 
                                          StrokeStartLineCap="Round"
                                          StrokeEndLineCap="Round"
                                          Data="M22.5,4.5 A 10.5,10.5 0 0 1 22.5,19.5"/>
                                </Canvas>
                            </Viewbox>
                        </Grid>
                        
                        <ControlTemplate.Triggers>
                            <!-- 1. Handle Muted State (Priority) -->
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="MuteIconGroup" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="VolumeIconGroup_Corrected" Property="Visibility" Value="Collapsed"/>
                            </Trigger>

                            <!-- 2. Handle Volume Levels for Waves (Target Stroke instead of Fill) -->
                            <!-- Low Volume: Turn on WaveS -->
                            <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource Self}, Converter={StaticResource VolumeToIconConverter}}" Value="Low">
                                <Setter TargetName="WaveS" Property="Stroke" Value="{Binding Foreground, RelativeSource={RelativeSource TemplatedParent}}"/>
                            </DataTrigger>
                            
                            <!-- Medium Volume: Turn on WaveS AND WaveM -->
                             <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource Self}, Converter={StaticResource VolumeToIconConverter}}" Value="Medium">
                                <Setter TargetName="WaveS" Property="Stroke" Value="{Binding Foreground, RelativeSource={RelativeSource TemplatedParent}}"/>
                                <Setter TargetName="WaveM" Property="Stroke" Value="{Binding Foreground, RelativeSource={RelativeSource TemplatedParent}}"/>
                            </DataTrigger>

                            <!-- High Volume: Turn on WaveS AND WaveM AND WaveL -->
                            <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource Self}, Converter={StaticResource VolumeToIconConverter}}" Value="High">
                                <Setter TargetName="WaveS" Property="Stroke" Value="{Binding Foreground, RelativeSource={RelativeSource TemplatedParent}}"/>
                                <Setter TargetName="WaveM" Property="Stroke" Value="{Binding Foreground, RelativeSource={RelativeSource TemplatedParent}}"/>
                                <Setter TargetName="WaveL" Property="Stroke" Value="{Binding Foreground, RelativeSource={RelativeSource TemplatedParent}}"/>
                            </DataTrigger>

                            <!-- 3. Hover Effects -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="MuteIconGroup" Property="Opacity" Value="0.8"/>
                                <Setter TargetName="VolumeIconGroup_Corrected" Property="Opacity" Value="0.8"/>
                                <Setter Property="Cursor" Value="Hand"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </CheckBox.Template>
            </CheckBox>
            
            <TextBlock Text="Beep Type" HorizontalAlignment="Center" Margin="0,15,0,5" FontWeight="SemiBold"/>
            <ComboBox x:Name="BeepTypeComboBox" HorizontalAlignment="Center" Width="150" SelectedItem="{Binding SelectedBeepType}">
                <ComboBox.ItemsSource>
                    <x:Array Type="{x:Type local:BeepType}">
                        <local:BeepType>LowTone</local:BeepType>
                        <local:BeepType>MediumTone</local:BeepType>
                        <local:BeepType>HighTone</local:BeepType>
                        <local:BeepType>Alert</local:BeepType>
                        <local:BeepType>Alarm</local:BeepType>
                        <local:BeepType>Error</local:BeepType>
                        <local:BeepType>Warning</local:BeepType>
                        <local:BeepType>Information</local:BeepType>
                        <local:BeepType>Question</local:BeepType>
                    </x:Array>
                </ComboBox.ItemsSource>
            </ComboBox>
            <TextBlock
    Width="150"
    Text="이 텍스트는 길어서 말줄임 처리됩니다."
    TextTrimming="CharacterEllipsis"
    ToolTip="{Binding Text, RelativeSource={RelativeSource Self}}"/>
            <Button Content="Play Beep" HorizontalAlignment="Center" Margin="0,10,0,0" Padding="10,5" Command="{Binding PlayBeepCommand}"/>
        </StackPanel>
    </Grid>
</Window>
